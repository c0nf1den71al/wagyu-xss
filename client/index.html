<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,700;0,900;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    backgroundColor: ['even'],
                },
            }
        }
    </script>
    <title>Wagyu Client</title>
</head>
<body>
<div class="flex flex-col h-screen w-screen relative">
    <!-- Alert Modal -->
    <div id="alertModal" class="hidden absolute top-0 left-0 w-full h-full bg-black bg-opacity-80 z-50 flex items-center justify-center">
        <div class="w-1/3 h-1/3 px-4 py-3 bg-white rounded-lg flex flex-col justify-between">
            <div class="flex flex-row justify-between">
                <h1 id="alertTitle" class="text-2xl font-bold">Default Title</h1>
            </div>
            <div id="alertBody" class="flex flex-col">

            </div>
            <div id="alertFooter" class="flex flex-row justify-end pb-2">
                <div class="flex flex-row w-full justify-end space-x-3">
                    <button class="py-2 px-3 bg-gray-200 text-gray-400 rounded-md font-medium" onclick="document.getElementById('alertModal').classList.add('hidden');">Back</button>
                    <button class="py-2 px-3 bg-rose-300 text-rose-800 rounded-md font-medium" id="submitButton">Set</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payload Editor -->
    <div id="payloadEditorModal" class="hidden absolute top-0 left-0 w-full h-full bg-black bg-opacity-80 z-50 flex items-center justify-center">
        <div class="w-3/4 h-3/4 bg-white rounded-lg flex flex-row">     
            <!-- Side menu -->       
            <div class="flex flex-col w-1/5 bg-gray-100 rounded-l-lg py-4 px-6 justify-between">
                <div>
                    <h1 class="text-2xl font-bold">Payloads</h1>
                </div>
                <div class="h-full pt-10">
                    <ul class="space-y-2" id="payload-editor-list"></ul>
                </div>
                <div>
                    <button id="create-payload-button" onclick="document.getElementById('blank-editor').classList.add('hidden'); document.getElementById('payload-editor-update').classList.add('hidden'); document.getElementById('payload-editor-create').classList.remove('hidden');" class="disabled:bg-gray-200 disabled:text-gray-400 px-3 py-2 bg-rose-200 text-rose-800 rounded-md font-medium"><i class="fa-solid fa-plus pr-2"></i>Create Payload</button>
                </div>
            </div>

            <!-- Editor Content -->
            <div class="flex flex-col w-4/5 h-full items-center">
                <i class="fa-solid fa-xl fa-xmark cursor-pointer place-self-end p-7" onclick="document.getElementById('payloadEditorModal').classList.add('hidden')"></i>
        
                <!-- Editor -->
                <div id="blank-editor" class="flex flex-col h-full justify-center">
                        <p class="text-gray-400" style="margin-top: -1.75rem;">Select a payload to edit</p>
                </div>
                
                <!-- Create Payload -->
                <div id="payload-editor-create" class="hidden flex flex-col overflow-y-scroll">
                    <div class="flex flex-row justify-between items-center px-7 py-4">
                        <h1 class="text-2xl font-bold">Create Payload</h1>
                    </div>
                    <div class="flex flex-row self-center">
                        <div class="px-7 py-4 flex flex-col">
                            <label class="font-medium" for="">Name</label>
                            <input type="text" placeholder="my-payload" id="create-payload-name" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                            <label class="font-medium" for="">Description</label>
                            <input type="text" placeholder="Super cool payload!"id="create-payload-description" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                            <div class="flex flex-row space-x-5">
                                <div class="w-1/3">
                                    <label class="font-medium" for="">Browser Compatibility</label>
                                    <input type="text" placeholder="All Browsers" id="create-payload-compatibility" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                                </div>
                                <div class="w-1/3">
                                    <label class="font-medium" for="">Type</label>
                                    <select id="create-payload-type" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                                        <option value="Recon">Recon</option>
                                        <option value="Exploit">Exploit</option>
                                        <option value="Lateral Movement">Lateral Movement</option>
                                        <option value="Data Exfiltration">Data Exfiltration</option>
                                        <option value="Persistence">Persistence</option>
                                        <option value="Misc.">Misc.</option>
                                    </select>
                                </div>
                                <div class="w-1/3">
                                    <label class="font-medium" for="">Risk (1-5) <i class="pl-1 fa-regular fa-circle-question fa-xs text-blue-600 cursor-pointer" title="How likely the victim is to notice this attack"></i></label>
                                    <input type="number" placeholder="1" min="1" max="5" id="create-payload-risk" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                                </div>
                            </div>
                            <label class="font-medium" for="create-payload-payload">Payload</label>
                            <textarea id="create-payload-payload" onkeydown="if(event.keyCode===9||event.key==='Tab'){var v=this.value,s=this.selectionStart,e=this.selectionEnd;this.value=v.substring(0, s)+'\t'+v.substring(e);this.selectionStart=this.selectionEnd=s+1;return false;}" placeholder="Payload..." cols="100" rows="12" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5 font-mono"></textarea>
                            <label class="font-medium" for="create-payload-notes">Notes</label>
                            <textarea id="create-payload-notes" onkeydown="if(event.keyCode===9||event.key==='Tab'){var v=this.value,s=this.selectionStart,e=this.selectionEnd;this.value=v.substring(0, s)+'\t'+v.substring(e);this.selectionStart=this.selectionEnd=s+1;return false;}" placeholder="Notes..." cols="100" rows="12" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5"></textarea>
                            <div class="flex flex-row w-full justify-end space-x-3">
                                <button onclick="document.getElementById('blank-editor').classList.remove('hidden'); document.getElementById('payload-editor-create').classList.add('hidden');" class="py-2 px-3 bg-gray-200 text-gray-400 rounded-md font-medium">Back</button>
                                <button class="py-2 px-3 bg-rose-300 text-rose-800 rounded-md font-medium" onclick="createPayload()">Create</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Update Payload -->
                <div id="payload-editor-update" class="hidden flex flex-col overflow-y-scroll">
                    <div class="flex flex-row justify-between items-center px-7 py-4">
                        <h1 class="text-2xl font-bold">Update Payload</h1>
                        <button onclick="document.getElementById('payload-editor-update').classList.add('hidden'); document.getElementById('blank-editor').classList.remove('hidden'); deletePayload()" class="px-3 py-2 bg-rose-200 text-rose-800 rounded-md font-medium"><i class="fa-solid fa-trash-can pr-2"></i>Delete Payload</button>
                    </div>
                    <div class="flex flex-row self-center">
                        <div class="px-7 py-4 flex flex-col">
                            <input type="hidden" id="update-payload-id">
                            <label class="font-medium" for="update-payload-name">Name</label>
                            <input type="text" placeholder="my-payload" id="update-payload-name" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                            <label class="font-medium" for="update-payload-description">Description</label>
                            <input type="text" placeholder="Super cool payload!" id="update-payload-description" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                            <div class="flex flex-row space-x-5">
                                <div class="w-1/3">
                                    <label class="font-medium" for="update-payload-compatibility">Browser compatibility</label>
                                    <input type="text" placeholder="All Browsers" id="update-payload-compatibility" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                                </div>
                                <div class="w-1/3">
                                    <label class="font-medium" for="update-payload-type">Type</label>
                                    <select id="update-payload-type" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                                        <option value="Recon">Recon</option>
                                        <option value="Exploit">Exploit</option>
                                        <option value="Lateral Movement">Lateral Movement</option>
                                        <option value="Data Exfiltration">Data Exfiltration</option>
                                        <option value="Misc.">Misc.</option>
                                    </select>
                                </div>
                                <div class="w-1/3">
                                    <label class="font-medium" for="update-payload-risk">Risk (1-5) <i class="pl-1 fa-regular fa-circle-question fa-xs text-blue-600 cursor-pointer" title="How likely the victim is to notice this attack"></i></label>
                                    <input type="number" placeholder="1" min="1" max="5" id="update-payload-risk" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                                </div>
                            </div>
                            <label class="font-medium" for="update-payload-payload">Payload</label>
                            <textarea id="update-payload-payload" onkeydown="if(event.keyCode===9||event.key==='Tab'){var v=this.value,s=this.selectionStart,e=this.selectionEnd;this.value=v.substring(0, s)+'\t'+v.substring(e);this.selectionStart=this.selectionEnd=s+1;return false;}" placeholder="Payload..." cols="100" rows="12" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5 font-mono"></textarea>
                            <label class="font-medium" for="update-payload-notes">Notes</label>
                            <textarea id="update-payload-notes" onkeydown="if(event.keyCode===9||event.key==='Tab'){var v=this.value,s=this.selectionStart,e=this.selectionEnd;this.value=v.substring(0, s)+'\t'+v.substring(e);this.selectionStart=this.selectionEnd=s+1;return false;}" placeholder="Notes..." cols="100" rows="12" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5"></textarea>
                            <div class="flex flex-row w-full justify-end space-x-3">
                                <button onclick="document.getElementById('blank-editor').classList.remove('hidden'); document.getElementById('payload-editor-update').classList.add('hidden');" class="py-2 px-3 bg-gray-200 text-gray-400 rounded-md font-medium">Back</button>
                                <button class="py-2 px-3 bg-rose-300 text-rose-800 rounded-md font-medium" onclick="updatePayload()">Update</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Implant -->
    <div id="createImplantModal" class="hidden absolute top-0 left-0 w-full h-full bg-black bg-opacity-80 z-50 flex items-center justify-center">
        <div class="w-1/2 h-3/4 bg-white rounded-lg flex flex-col">
            <i class="fa-solid fa-xl fa-xmark cursor-pointer place-self-end p-7" onclick="document.getElementById('createImplantModal').classList.add('hidden')"></i>

            <!-- Create Implant -->
            <div class="flex flex-row justify-between items-center px-7 py-4">
                <h1 class="text-2xl font-bold">Create Implant</h1>
            </div>
            <div class="flex flex-row self-center overflow-y-scroll">
                <div class="px-7 py-4 flex flex-col h-full">
                    <label class="font-medium" for="create-implant-server">Callback Server</label>
                    <input type="text" placeholder="http://localhost:3000" id="create-implant-server" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                    <label class="font-medium" for="create-implant-initial-payload">Initial Payload</label>
                    <select id="create-implant-initial-payload" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                        <option value="">None</option>
                    </select>
                    <div class="flex flex-row space-x-5">
                        <div class="w-1/3">
                            <label class="font-medium" for="create-implant-callback-interval">Callback Interval (s)</label>
                            <input type="number" placeholder="300" value="300" id="create-implant-callback-interval" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                        </div>
                        <div class="w-1/3">
                            <label class="font-medium" for="create-implant-min-jitter">Min Jitter (s)</label>
                            <input type="number" placeholder="30" value="30" id="create-implant-min-jitter" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                        </div>
                        <div class="w-1/3">
                            <label class="font-medium" for="create-implant-max-jitter">Max Jitter (s)</label>
                            <input type="number" placeholder="60" value="60" id="create-implant-max-jitter" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                        </div>
                    </div>
                    <label class="font-medium" for="create-implant-host-cookie">Host ID Cookie</label>
                    <input type="text" placeholder="HID" value="HID" id="create-implant-host-cookie" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                    <label class="font-medium" for="">Host Registration Endpoint</label>
                    <input type="text" placeholder="/register" value="/register" id="" class="hover:cursor-not-allowed disabled:text-gray-300 appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5" disabled>
                    <label class="font-medium" for="">Host Callback Endpoint</label>
                    <input type="text" placeholder="/<host_id>" value="/<host_id>" id="" class="hover:cursor-not-allowed disabled:text-gray-300 appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5" disabled>
                    <div class="flex flex-row w-full justify-end space-x-3 pb-5">
                        <button onclick="document.getElementById('createImplantModal').classList.add('hidden');" class="py-2 px-3 bg-gray-200 text-gray-400 rounded-md font-medium">Back</button>
                        <button class="py-2 px-3 bg-rose-300 text-rose-800 rounded-md font-medium" onclick="generateImplant()">Create</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settingsModal" class="hidden absolute top-0 left-0 w-full h-full bg-black bg-opacity-80 z-50 flex items-center justify-center">
        <div class="w-3/4 h-3/4 bg-white rounded-lg flex flex-row">     
            <!-- Side menu -->       
            <div class="flex flex-col w-1/5 bg-gray-100 rounded-l-lg py-4 px-6 justify-between">
                <div>
                    <h1 class="text-2xl font-bold">Settings</h1>
                </div>
                <div class="h-full pt-10">
                    <ul class="space-y-2">
                        <li><button class="px-3 py-2 hover:bg-rose-100 rounded-md" title="Not current available"><i class="fa-solid fa-gear pr-2"></i>General</button></li>
                        <li><button class="px-3 py-2 hover:bg-rose-100 rounded-md" title="Not current available"><i class="fa-solid fa-palette pr-2"></i>Appearance</button></li>
                        <li><button class="font-medium px-3 py-2 bg-rose-200 text-rose-800 rounded-md"><i class="fa-solid fa-user pr-2"></i>Users</button></li>
                        <li><button class="px-3 py-2 hover:bg-rose-100 rounded-md" title="Not current available"><i class="fa-solid fa-circle-info pr-2"></i>About</button></li>
                        <li><button class="px-3 py-2 hover:bg-rose-100 rounded-md" onclick="ipcRenderer.send('logout')"><i class="fa-solid fa-door-open pr-2"></i>Logout</button></li>
                    </ul>
                </div>
                <div>
                    <p class="text-gray-300 text-sm">Wagyu XSS Client v1.0.0</p>
                </div>
            </div>

            <!-- Settings Content -->
            <div class="flex flex-col w-4/5 h-full">
                <i class="fa-solid fa-xl fa-xmark cursor-pointer place-self-end p-7" onclick="document.getElementById('settingsModal').classList.add('hidden')"></i>
                <!-- General Settings -->
                <div class="hidden">

                </div>
                <!-- Appearance Settings -->
                <div class="hidden">

                </div>
                <!-- Users Settings -->
                <div id="settings-users" class="flex flex-col">
                    <div class="flex flex-row justify-between items-center px-7 py-4">
                        <h1 class="text-2xl font-bold">Users</h1>
                        <button id="add-user-button" disabled onclick="document.getElementById('settings-users').classList.add('hidden'); document.getElementById('settings-create-user').classList.remove('hidden');" class="disabled:bg-gray-100 disabled:text-gray-400 px-3 py-2 bg-rose-200 text-rose-800 rounded-md font-medium"><i class="fa-solid fa-plus pr-2"></i>Add User</button>
                    </div>
                    <div class="flex flex-row px-7 py-4">
                        <table class="w-full">
                            <thead class="bg-slate-100">
                            <tr>
                                <th class="border font-medium px-4 py-2">Username</th>
                                <th class="border font-medium px-4 py-2">Role</th>
                                <th class="border font-medium px-4 py-2">Date Created</th>
                                <th class="border font-medium px-4 py-2">Actions</th>
                            </tr>
                            </thead>
                            <tbody class="text-center" id="users-table-body">
                            
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td class="px-4 py-2 text-slate-300 text-center" colspan="6">Create more users for them to show here...</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                
                <!-- Create User Settings-->
                <div id="settings-create-user" class="hidden flex flex-col">
                    <div class="flex flex-row justify-between items-center px-7 py-4">
                        <h1 class="text-2xl font-bold">Create User</h1>
                    </div>
                    <div class="flex flex-row self-center">
                        <div class="px-7 py-10 flex flex-col">
                            <label class="font-medium" for="create-user-username">Username</label>
                            <input type="text" placeholder="wagyu" name="username" id="create-user-username" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                            <label class="font-medium" for="create-user-role">Role</label>
                            <select id="create-user-role" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                                <option value="User">User</option>
                                <option value="Admin">Admin</option>
                            </select>
                            <div class="flex flex-row space-x-5">
                                <div class="flex flex-col"> 
                                    <label class="font-medium" for="create-user-password">Password</label>
                                    <input type="password" placeholder="••••••••" name="password" id="create-user-password" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                                </div>
                                <div class="flex flex-col"> 
                                    <label class="font-medium" for="create-user-password-confirm">Confirm Password</label>
                                    <input type="password" placeholder="••••••••" name="password" id="create-user-password-confirm" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                                </div>
                            </div>
                            <div class="flex flex-row w-full justify-end space-x-3">
                                <button onclick="document.getElementById('settings-users').classList.remove('hidden'); document.getElementById('settings-create-user').classList.add('hidden')" class="py-2 px-3 bg-gray-200 text-gray-400 rounded-md font-medium">Back</button>
                                <button class="py-2 px-3 bg-rose-300 text-rose-800 rounded-md font-medium" onclick="createUser()">Create</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Edit User Settings-->
                <div id="settings-edit-user" class="hidden flex flex-col">
                    <div class="flex flex-row justify-between items-center px-7 py-4">
                        <h1 class="text-2xl font-bold">Edit User</h1>
                    </div>
                    <div class="flex flex-row self-center">
                        <div class="px-7 py-10 flex flex-col">
                            <input type="hidden" id="edit-user-id">
                            <label class="font-medium" for="edit-user-username">Username</label>
                            <input type="text" placeholder="wagyu" name="username" id="edit-user-username" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                            <label class="font-medium" for="edit-user-role">Role</label>
                            <select id="edit-user-role" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                                <option value="User">User</option>
                                <option value="Admin">Admin</option>
                            </select>
                            <div class="flex flex-row space-x-5">
                                <div class="flex flex-col"> 
                                    <label class="font-medium" for="edit-user-password">Password</label>
                                    <input type="password" placeholder="••••••••" name="password" id="edit-user-password" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                                </div>
                                <div class="flex flex-col"> 
                                    <label class="font-medium" for="edit-user-password-confirm">Confirm Password</label>
                                    <input type="password" placeholder="••••••••" name="password" id="edit-user-password-confirm" class="appearance-none border rounded-md w-full py-2 px-3 leading-tight mb-5">
                                </div>
                            </div>
                            <div class="flex flex-row w-full justify-end space-x-3">
                                <button onclick="document.getElementById('settings-users').classList.remove('hidden'); document.getElementById('settings-edit-user').classList.add('hidden')" class="py-2 px-3 bg-gray-200 text-gray-400 rounded-md font-medium">Back</button>
                                <button class="py-2 px-3 bg-rose-300 text-rose-800 rounded-md font-medium" onclick="updateUser()">Update</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- About -->
                <div class="hidden">

                </div>
            </div>
        </div>
    </div>


    <!-- Navbar -->
    <div class="flex w-full justify-between p-3.5 shadow-md z-10" style="height: 10%;">
            <!-- Brand -->
            <div class="flex items-center">
                <img class="w-10" src="images/steak.png" alt="Tailwind CSS Logo">
                <h1 class="text-2xl font-bold pl-2">Wagyu</h1>
            </div>

            <!-- Navbar -->
            <div class="flex pr-5">
                <button onclick="document.getElementById('payloadEditorModal').classList.remove('hidden')" class="hover:bg-rose-100 rounded-md px-3.5 h-full flex items-center font-medium"><i class="fa-solid fa-code pr-2"></i>Payload Editor</button>
                <button onclick="document.getElementById('settingsModal').classList.remove('hidden'); loadSettings()" class="hover:bg-rose-100 rounded-md px-3.5 h-full flex items-center font-medium"><i class="fa-solid fa-gear pr-2"></i>Settings</button>
            </div>
    </div>
    <!-- Main -->
    <div class="flex flex-col justify-center" style="height: 90%;">
        <!-- Top -->
        <div class="h-2/3 flex flex-row">
            <div class="w-3/4">

                <!-- Top bar -->
                <div class="w-full flex flex-row justify-between h-[9%]">
                    <div class="flex">
                        <div id="hosts-tab" class="h-full py-2 px-4 bg-rose-200 text-rose-800 cursor-pointer font-medium">Hosts</div>
                        <div id="payloads-tab" class="h-full py-2 px-4 cursor-pointer hover:bg-rose-50">Payloads</div>
                        <div id="implants-tab" class="h-full py-2 px-4 cursor-pointer hover:bg-rose-50">Implants</div>
                        <div id="findings-tab" class="h-full py-2 px-4 cursor-pointer hover:bg-rose-50">Findings</div>
                    </div>
                    <div class="flex pr-3">
                        <div class="h-full py-2 px-2 pt-2.5 font-medium" title="Add"><i id="add-button" class="hidden cursor-pointer fa-solid fa-plus"></i></div>
                        <div id="refresh" class="h-full py-2 px-2 pt-2.5 font-medium" title="Refresh"><i class="cursor-pointer fa-solid fa-rotate-right"></i></div>
                    </div>
                </div>

                <!-- Tables -->
                <div id="tables" class="overflow-auto h-[91%]">
                    <!-- Hosts table -->
                    <table id="hosts-table" class="w-full">
                        <thead class="bg-slate-100 sticky top-[-1px]">
                            <tr>
                                <th class="border font-medium px-4 py-2">ID</th>
                                <th class="border font-medium px-4 py-2">Current Status</th>
                                <th class="border font-medium px-4 py-2">Public IP</th>
                                <th class="border font-medium px-4 py-2">OS</th>
                                <th class="border font-medium px-4 py-2">Browser</th>
                                <th class="border font-medium px-4 py-2">Current Tab</th>
                                <th class="border font-medium px-4 py-2">Last Seen</th>
                                <th class="border font-medium px-4 py-2">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="text-center" id="hosts-table-body"></tbody>
                        <tfoot>
                            <tr>
                                <td class="px-4 py-2 text-slate-300 text-center" colspan="8">Continue compromising hosts for them to show here...</td>
                            </tr>
                        </tfoot>
                    </table>

                    <!-- Payloads table -->
                    <table id="payloads-table" class="w-full hidden">
                        <thead class="bg-slate-100 sticky top-[-1px]">
                        <tr>
                            <th class="border font-medium px-4 py-2">Name</th>
                            <th class="border font-medium px-4 py-2">Description</th>
                            <th class="border font-medium px-4 py-2">compatibility</th>
                            <th class="border font-medium px-4 py-2">Type</th>
                            <th class="border font-medium px-4 py-2">Author</th>
                            <th class="border font-medium px-4 py-2">Risk</th>
                            <th class="border font-medium px-4 py-2">Notes</th>
                            <th class="border font-medium px-4 py-2">Actions</th>
                        </tr>
                        </thead>
                        <tbody id="payloads-table-body" class="text-center"></tbody>
                        <tfoot>
                        <tr>
                            <td class="px-4 py-2 text-slate-300 text-center" colspan="8">Create more payloads for them to show here...</td>
                        </tr>
                        </tfoot>
                    </table>

                    <!-- Implants Table -->
                    <table id="implants-table" class="w-full hidden">
                        <thead class="bg-slate-100 sticky top-[-1px]">
                        <tr>
                            <th class="border font-medium px-4 py-2">ID</th>
                            <th class="border font-medium px-4 py-2">Date Created</th>
                            <th class="border font-medium px-4 py-2">Callback Server</th>
                            <th class="border font-medium px-4 py-2">Initial Payload</th>
                            <th class="border font-medium px-4 py-2">Callback Interval</th>
                            <th class="border font-medium px-4 py-2">Jitter</th>
                            <th class="border font-medium px-4 py-2">Actions</th>
                        </tr>
                        </thead>
                        <tbody id="implants-table-body" class="text-center"></tbody>
                        <tfoot>
                            <tr>
                                <td class="px-4 py-2 text-slate-300 text-center" colspan="7">Create more implants for them to show here...</td>
                            </tr>
                        </tfoot>
                    </table>

                    <!-- Findings Table -->
                    <table id="findings-table" class="w-full hidden">
                        <thead class="bg-slate-100 sticky top-[-1px]">
                        <tr>
                            <th class="border font-medium px-4 py-2">Date Created</th>
                            <th class="border font-medium px-4 py-2">Name</th>
                            <th class="border font-medium px-4 py-2">Value</th>
                            <th class="border font-medium px-4 py-2">Created By</th>
                            <th class="border font-medium px-4 py-2">Associated Host</th>
                            <th class="border font-medium px-4 py-2">Actions</th>
                        </tr>
                        </thead>
                        <tbody id="findings-table-body" class="text-center"></tbody>
                        <tfoot>
                            <tr>
                                <td class="px-4 py-2 text-slate-300 text-center" colspan="6">Execute payloads for the findings to show here...</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <!-- Event Log -->
            <div class="w-1/4 bg-slate-500 flex flex-col justify-between" onclick="document.getElementById('chatbox').focus()">
                <!-- Top bar -->
                <div class="w-full h-10 flex flex-row bg-white justify-between">
                    <div class="h-full py-2 px-4 bg-rose-200 text-rose-800 cursor-pointer font-medium">Event Log</div>
                    <div class="flex">
                        <div class="h-full py-2 px-4 bg-slate-100 cursor-pointer font-medium" title="Export event log"><i class="fa-solid fa-download"></i></div>
                        <div class="h-full py-2 px-4 bg-slate-100 cursor-pointer font-medium" title="Filter"><i class="fa-solid fa-filter"></i></div>
                    </div>
                </div>
                <p id="eventLog" class="text-sm overflow-y-auto break-words whitespace-normal pt-1.5 h-full font-mono"></p>
                <input type="text" id="chatbox" class=" text-sm bg-slate-400 px-1.5 py-1 text-white placeholder:text-slate-200" placeholder="Type here to chat...">
            </div>
        </div>

        <!-- Command Line -->
        <div id="commandContainer" class="h-1/3 bg-slate-100 p-5 relative z-0 overflow-auto" onclick="document.getElementById('command').focus()" ondrop="drop(event)" ondragover="allowDrop(event)">
            <div id="commandOutput" class="text-sm"></div> <!-- Insert command output here -->
            <!-- Input -->
            <div class="flex text-sm">
                <p id="cli-identity" class="text-rose-400 font-semibold whitespace-nowrap pr-2.5">wagyu@wagyu #</p>
                <input type="text" id="command" ondrop="drop(event)" ondragover="allowDrop(event)" class="bg-transparent font-normal w-full" placeholder="Command...">
            </div>
            <!-- Drag and drop overlay -->
            <div id="dragDropOverlay" class="absolute bg-rose-200 opacity-75 inset-0 p-16 hidden">
                <div class="relative border-4 rounded-md opacity-100 border-rose-800 border-dashed h-full flex justify-center items-center">
                    <i class="fa-solid fa-plus fa-4x opacity-100 text-rose-800 pr-3"></i>
                    <p class="opacity-100 text-rose-800 font-semibold text-lg pl-3">Drag a host here to autofill...</p>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    const { ipcRenderer, remote, shell } = require('electron')
    const { parseUserAgent } = require("./helpers/hosts")

    let commandHistory = []
    let commandHistoryIndex = 0

    let globalUsername = "wagyu"
    let globalRole = "User" // Only affects the UI

    ipcRenderer.invoke("checkLogin").then((res) => {
        if (res === false) {
            window.location.href = "login.html"
        } else {
            globalUsername = res.username
            document.getElementById("cli-identity").innerText = `${xssSanitize(globalUsername)}@wagyu #`;
            
            globalRole = res.role // Only affects the UI
            if (globalRole === "Admin") {
                document.getElementById("add-user-button").disabled = false;
            }
        }
    })

    // Tabs
    const hostsTab = document.getElementById("hosts-tab");
    const hostsTable = document.getElementById("hosts-table");
    const payloadsTab = document.getElementById("payloads-tab");
    const payloadsTable = document.getElementById("payloads-table");
    const implantsTab = document.getElementById("implants-tab");
    const implantsTable = document.getElementById("implants-table");
    const findingsTab = document.getElementById("findings-tab");
    const findingsTable = document.getElementById("findings-table");
    const addButton = document.getElementById("add-button");

    // XSS Prevention - please use this function when inserting text into the DOM
    function xssSanitize(input) {
        return input.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }

    // Find a better way to do this
    payloadsTab.addEventListener("click", () => {
        payloadsTab.classList.add("bg-rose-200");
        payloadsTab.classList.add("text-rose-800");
        payloadsTab.classList.remove("hover:bg-rose-50");
        payloadsTab.classList.add("font-medium");
        payloadsTable.classList.remove("hidden");
        hostsTab.classList.remove("bg-rose-200");
        hostsTab.classList.add("hover:bg-rose-50");
        hostsTab.classList.remove("font-medium");
        hostsTab.classList.remove("text-rose-800");
        hostsTable.classList.add("hidden");
        implantsTab.classList.remove("bg-rose-200");
        implantsTab.classList.add("hover:bg-rose-50");
        implantsTab.classList.remove("font-medium");
        implantsTab.classList.remove("text-rose-800");
        implantsTable.classList.add("hidden");
        findingsTable.classList.add("hidden");
        findingsTab.classList.remove("bg-rose-200");
        findingsTab.classList.remove("font-medium");
        findingsTab.classList.add("hover:bg-rose-50");
        findingsTab.classList.remove("text-rose-800");
        addButton.classList.remove("hidden");
        addButton.onclick = () => {
            document.getElementById("payloadEditorModal").classList.remove("hidden");
            document.getElementById('payload-editor-create').classList.remove('hidden');
            document.getElementById('blank-editor').classList.add('hidden');
        }
    });

    hostsTab.addEventListener("click", () => {
        hostsTab.classList.add("bg-rose-200");
        hostsTab.classList.add("text-rose-800");
        hostsTab.classList.remove("hover:bg-rose-50");
        hostsTab.classList.add("font-medium");
        hostsTable.classList.remove("hidden");
        payloadsTab.classList.remove("bg-rose-200");
        payloadsTab.classList.add("hover:bg-rose-50");
        payloadsTab.classList.remove("font-medium");
        payloadsTab.classList.remove("text-rose-800");
        payloadsTable.classList.add("hidden");
        implantsTab.classList.remove("bg-rose-200");
        implantsTab.classList.add("hover:bg-rose-50");
        implantsTab.classList.remove("font-medium");
        implantsTab.classList.remove("text-rose-800");
        implantsTable.classList.add("hidden");
        findingsTable.classList.add("hidden");
        findingsTab.classList.remove("bg-rose-200");
        findingsTab.classList.add("hover:bg-rose-50");
        findingsTab.classList.remove("font-medium");
        findingsTab.classList.remove("text-rose-800");
        addButton.classList.add("hidden");
    });

    implantsTab.addEventListener("click", () => {
        implantsTab.classList.add("bg-rose-200");
        implantsTab.classList.add("text-rose-800");
        implantsTab.classList.remove("hover:bg-rose-50");
        implantsTab.classList.add("font-medium");
        implantsTable.classList.remove("hidden");
        payloadsTab.classList.remove("bg-rose-200");
        payloadsTab.classList.add("hover:bg-rose-50");
        payloadsTab.classList.remove("font-medium");
        payloadsTab.classList.remove("text-rose-800");
        payloadsTable.classList.add("hidden");
        hostsTab.classList.remove("bg-rose-200");
        hostsTab.classList.add("hover:bg-rose-50");
        hostsTab.classList.remove("font-medium");
        hostsTab.classList.remove("text-rose-800");
        hostsTable.classList.add("hidden");
        findingsTable.classList.add("hidden");
        findingsTab.classList.remove("bg-rose-200");
        findingsTab.classList.add("hover:bg-rose-50");
        findingsTab.classList.remove("font-medium");
        findingsTab.classList.remove("text-rose-800");
        addButton.classList.remove("hidden");
        addButton.onclick = () => {
            document.getElementById("createImplantModal").classList.remove("hidden");
            ipcRenderer.invoke("getAllPayloads").then(response => {
                document.getElementById("create-implant-server").value = xssSanitize(response.server);
                document.getElementById("create-implant-initial-payload").innerHTML = "<option value=''>None</option>"
                response.payloads.forEach(payload => {
                    document.getElementById("create-implant-initial-payload").innerHTML += `<option value="${xssSanitize(payload._id.toString())}">${xssSanitize(payload.name)}</option>`
                })
            })
        }
    });

    findingsTab.addEventListener("click", () => {
        findingsTab.classList.add("bg-rose-200");
        findingsTab.classList.add("text-rose-800");
        findingsTab.classList.remove("hover:bg-rose-50");
        findingsTab.classList.add("font-medium");
        findingsTable.classList.remove("hidden");
        payloadsTab.classList.remove("bg-rose-200");
        payloadsTab.classList.add("hover:bg-rose-50");
        payloadsTab.classList.remove("font-medium");
        payloadsTab.classList.remove("text-rose-800");
        payloadsTable.classList.add("hidden");
        hostsTab.classList.remove("bg-rose-200");
        hostsTab.classList.add("hover:bg-rose-50");
        hostsTab.classList.remove("font-medium");
        hostsTab.classList.remove("text-rose-800");
        hostsTable.classList.add("hidden");
        implantsTable.classList.add("hidden");
        implantsTab.classList.remove("bg-rose-200");
        implantsTab.classList.add("hover:bg-rose-50");
        implantsTab.classList.remove("font-medium");
        implantsTab.classList.remove("text-rose-800");
        addButton.classList.add("hidden");
    });

    function loadSettings() {
        ipcRenderer.invoke("getAllUsers"); 
    }

    ipcRenderer.on("users", (event, users) => {
        // Clear current findings from DOM
        document.getElementById("users-table-body").innerHTML = "";
        users.forEach(user => {
            const timestamp = new Date(user.timestamp).toLocaleString()
            const userId = xssSanitize(user._id.toString());
            const userUsername = xssSanitize(user.username);
            const userRole = xssSanitize(user.role);
            const tableRow = `<tr>
                <td class="border px-4 py-2 truncate">${userUsername}</td>
                <td class="border px-4 py-2 truncate">${userRole}</td>
                <td class="border px-4 py-2 truncate">${timestamp}</td>
                ${globalRole === "Admin" ? `
                    <td class="border px-4 py-2"><i class="fa-solid fa-pencil px-2 cursor-pointer" title="Modify user" onclick="document.getElementById('settings-users').classList.add('hidden'); document.getElementById('edit-user-id').value = '${userId}'; document.getElementById('edit-user-username').value = '${userUsername}'; document.getElementById('edit-user-role').value = '${userRole}'; document.getElementById('settings-edit-user').classList.remove('hidden');"></i><i onclick="ipcRenderer.invoke('deleteUserById', '${userId}')" class="fa-solid fa-trash px-2 cursor-pointer" title="Delete user"></i></td>
                `:`  
                    <td class="border px-4 py-2"><i class="fa-solid fa-pencil px-2 text-gray-300" title="Admin privileges required"></i><i class="fa-solid fa-trash px-2 text-gray-300" title="Admin privileges required"></i></td>
                `}
                
            </tr>`
            
            document.getElementById("users-table-body").innerHTML += tableRow
        })
    });

    ipcRenderer.on("refreshUsers", () => {
        ipcRenderer.invoke("getAllUsers")
    });

    ipcRenderer.on("refreshPayloads", () => {
        ipcRenderer.invoke("getAllPayloads")
    });


    function createUser() {
        let username = document.getElementById("create-user-username")
        let role = document.getElementById("create-user-role")
        let password = document.getElementById("create-user-password")
        let passwordConfirm = document.getElementById("create-user-password-confirm")
        
        let inputArray = [username, role, password, passwordConfirm]
        inputArray.forEach(input => {
            if (input.value === "") {
                input.classList.add("border-red-500");
            } else {
                input.classList.remove("border-red-500");
            }
        })

        if (password.value !== passwordConfirm.value) {
            password.classList.add("border-red-500");
            passwordConfirm.classList.add("border-red-500");
            return;
        }

        if(username.value !== "" && role.value !== "" && password.value !== "" && passwordConfirm.value !== "") {
            ipcRenderer.invoke("createUser", username.value, password.value, passwordConfirm.value, role.value);
            username.value = "";
            role.value = "User";
            password.value = "";
            passwordConfirm.value = "";
            document.getElementById("settings-create-user").classList.add("hidden");
            document.getElementById("settings-users").classList.remove("hidden");
        }
    }

    function updateUser() {
        let id = document.getElementById("edit-user-id")
        let username = document.getElementById("edit-user-username")
        let role = document.getElementById("edit-user-role")
        let password = document.getElementById("edit-user-password")
        let passwordConfirm = document.getElementById("edit-user-password-confirm")

        if (password.value !== passwordConfirm.value) {
            password.classList.add("border-red-500");
            passwordConfirm.classList.add("border-red-500");
            return;
        }

        ipcRenderer.invoke("updateUser", id.value, username.value, password.value, passwordConfirm.value, role.value);
        password.value = "";
        passwordConfirm.value = "";
        document.getElementById("settings-edit-user").classList.add("hidden");
        document.getElementById("settings-users").classList.remove("hidden");
    }

    function createPayload() {
        let name = document.getElementById("create-payload-name")
        let description = document.getElementById("create-payload-description")
        let compatibility = document.getElementById("create-payload-compatibility")
        let type = document.getElementById("create-payload-type")
        let risk = document.getElementById("create-payload-risk")
        let payload = document.getElementById("create-payload-payload")
        let notes = document.getElementById("create-payload-notes")

        let inputArray = [name, description, compatibility, type, risk, payload]
        inputArray.forEach(input => {
            if (input.value === "") {
                input.classList.add("border-red-500");
            } else {
                input.classList.remove("border-red-500");
            }
        })

        if(name.value !== "" && description.value !== "" && compatibility.value !== "" && type.value !== "" && risk.value !== "" && payload.value !== "") {
            ipcRenderer.invoke("createPayload", name.value, description.value, compatibility.value, type.value, risk.value, payload.value, notes.value);
            name.value = "";
            description.value = "";
            compatibility.value = "";
            type.value = "Recon";
            risk.value = ""
            payload.value = "";
            notes.value = "";
            document.getElementById('blank-editor').classList.remove('hidden');
            document.getElementById('payload-editor-create').classList.add('hidden');
        }
    }

    function loadPayloadEditor(payload) {
        document.getElementById("payload-editor-update").classList.remove("hidden");
        document.getElementById("blank-editor").classList.add("hidden");
        document.getElementById("payload-editor-create").classList.add("hidden");

        document.getElementById("update-payload-id").value = payload._id;
        document.getElementById("update-payload-name").value = payload.name;
        document.getElementById("update-payload-description").value = payload.description;
        document.getElementById("update-payload-compatibility").value = payload.compatibility;
        document.getElementById("update-payload-type").value = payload.type;
        document.getElementById("update-payload-risk").value = payload.risk;
        document.getElementById("update-payload-payload").value = payload.payload;
        document.getElementById("update-payload-notes").value = payload.notes || "";
    }

    function updatePayload() {
        let id = document.getElementById("update-payload-id");
        let name = document.getElementById("update-payload-name");
        let description = document.getElementById("update-payload-description");
        let compatibility = document.getElementById("update-payload-compatibility");
        let type = document.getElementById("update-payload-type");
        let risk = document.getElementById("update-payload-risk");
        let payload = document.getElementById("update-payload-payload");
        let notes = document.getElementById("update-payload-notes");

        let inputArray = [name, description, compatibility, type, risk, payload]
        inputArray.forEach(input => {
            if (input.value === "") {
                input.classList.add("border-red-500");
            } else {
                input.classList.remove("border-red-500");
            }
        })

        if(id.value !== "" && name.value !== "" && description.value !== "" && compatibility.value !== "" && type.value !== "" && risk.value !== "" && payload.value !== "") {
            ipcRenderer.invoke("updatePayload", id.value, name.value, description.value, compatibility.value, type.value, risk.value, payload.value, notes.value);

            document.getElementById('blank-editor').classList.remove('hidden');
            document.getElementById('payload-editor-update').classList.add('hidden');
        }
    }

    function deletePayload(id) {
        if (id === undefined) {
            id = document.getElementById("update-payload-id").value;
        }
        ipcRenderer.invoke("deletePayload", id);
        document.getElementById('blank-editor').classList.remove('hidden');
        document.getElementById('payload-editor-update').classList.add('hidden');
    }

    ipcRenderer.invoke("getAllEventLogs")
    ipcRenderer.on('eventLogs', (event, eventLogs) => {
        
        // If there are new event logs scroll to the bottom of the div
        if (eventLogs.length > document.getElementById("eventLog").children.length) {
            document.getElementById("eventLog").scrollTop = document.getElementById("eventLog").scrollHeight;
       }

        document.getElementById("eventLog").innerHTML = ""; // Clear current event logs from DOM

        eventLogs.forEach(log => {
            const timestamp = new Date(log.timestamp).toLocaleTimeString()
            const createdBy = xssSanitize(log.createdBy)
            const message = xssSanitize(log.message)
            switch(log.type) {
                case "info":
                    document.getElementById("eventLog").innerHTML += `<p class="text-white px-1.5">[${timestamp}][${createdBy}] ${message}</p>`
                    break;
                case "success":
                    document.getElementById("eventLog").innerHTML += `<p class="text-green-500 px-1.5">[${timestamp}][${createdBy}] ${message}</p>`
                    break;
                case "error":
                    document.getElementById("eventLog").innerHTML += `<p class="text-red-400 px-1.5">[${timestamp}][${createdBy}] ${message}</p>`
                    break;
                case "warning":
                    document.getElementById("eventLog").innerHTML += `<p class="text-yellow-400 px-1.5">[${timestamp}][${createdBy}] ${message}</p>`
                    break;
                case "chat":
                    document.getElementById("eventLog").innerHTML += `<p class="text-blue-400 px-1.5">[${timestamp}][${createdBy}] ${message}</p>`
                    break;
            }
        });
    })

    setTimeout(function(){document.getElementById("eventLog").scrollTop = document.getElementById("eventLog").scrollHeight;}, 200); // Scroll to the bottom once on first load

    document.getElementById("chatbox").addEventListener("keyup", function(event) {
        if (event.key === "Enter") {
            const message = document.getElementById("chatbox").value
            ipcRenderer.invoke("createEventLog", message, "chat")
        }
    });

    ipcRenderer.on('chatSent', (event) => {
        document.getElementById("chatbox").value = ""
        document.getElementById("eventLog").scrollTop = document.getElementById("eventLog").scrollHeight; // Scroll to bottom of event log
        ipcRenderer.invoke("getAllEventLogs") // Temporary solution to update chat
    })

    document.getElementById("refresh").addEventListener("click", () => {
        ipcRenderer.invoke("getAllEventLogs")
        ipcRenderer.invoke("getAllImplants")
        ipcRenderer.invoke("getAllPayloads")
        ipcRenderer.invoke("getAllHosts")
        ipcRenderer.invoke("getAllFindings")
    })

    setInterval(() => {
        ipcRenderer.invoke("getAllEventLogs")
        ipcRenderer.invoke("getAllImplants")
        ipcRenderer.invoke("getAllPayloads")
        ipcRenderer.invoke("getAllHosts")
        ipcRenderer.invoke("getAllFindings")
    }, 5000);

    function generateImplant() {
        const server = document.getElementById("create-implant-server")
        const initialPayload = document.getElementById("create-implant-initial-payload")
        const callbackInterval = document.getElementById("create-implant-callback-interval")
        const minJitter = document.getElementById("create-implant-min-jitter")
        const maxJitter = document.getElementById("create-implant-max-jitter")
        const hostCookie = document.getElementById("create-implant-host-cookie")
        if(parseInt(maxJitter.value) < parseInt(callbackInterval.value)) {
            callbackInterval.classList.remove("border-red-500");
            
            if ((parseInt(minJitter.value) <= parseInt(maxJitter.value)) && (parseInt(minJitter.value) > -1) && (parseInt(maxJitter.value) > -1)) {
                minJitter.classList.remove("border-red-500");
                maxJitter.classList.remove("border-red-500");

                if (server.value !== "") {
                    document.getElementById("create-implant-server").classList.add("border-red-500")
                    ipcRenderer.invoke("generateImplant", server.value, initialPayload.value, callbackInterval.value, minJitter.value, maxJitter.value, hostCookie.value)
                    server.value = ""
                    initialPayload.value = ""
                    callbackInterval.value = 300
                    minJitter.value = 30
                    maxJitter.value = 60
                    hostCookie.value = "HID"
                    document.getElementById("createImplantModal").classList.add("hidden")
                } else {
                    document.getElementById("create-implant-server").classList.add("border-red-500")
                }

            } else {
                minJitter.classList.add("border-red-500");
                maxJitter.classList.add("border-red-500");
            }

        } else {
            callbackInterval.classList.add("border-red-500");
            maxJitter.classList.add("border-red-500");
        }
    }

    ipcRenderer.invoke("getAllImplants")
    ipcRenderer.on("implants", (event, implants, serverDomain) => {
        // Clear current implants from DOM
        document.getElementById("implants-table-body").innerHTML = "";

        implants.forEach(implant => {
            const timestamp = new Date(implant.timestamp).toLocaleString()
            const implantId = xssSanitize(implant._id.toString())
            const implantServer = xssSanitize(implant.server)
            const initialPayloadName = xssSanitize(implant.initialPayload.name)
            const implantLink = xssSanitize(`${serverDomain}/implants/${implantId}.js`)
            const implantCallback = implant.callbackInterval / 1000
            const implantMinJitter = implant.minJitter / 1000
            const implantMaxJitter = implant.maxJitter / 1000
            const tableRow = `<tr>
                <td class="border px-4 py-2 truncate">${implantId}</td>
                <td class="border px-4 py-2 truncate text-center">${timestamp}</td>
                <td class="border px-4 py-2 truncate">${implantServer}</td>
                <td class="border px-4 py-2 truncate">${initialPayloadName ? initialPayloadName : `None`}</td>
                <td class="border px-4 py-2 truncate">${implantCallback} Seconds</td>
                <td class="border px-4 py-2 truncate">${implantMaxJitter == 0 && implantMinJitter == 0 ? `None` : `${implantMinJitter} - ${implantMaxJitter} Seconds`}</td>
                <td class="border px-4 py-2 truncate"><i onclick="navigator.clipboard.writeText('${implantLink}')" class="fa-solid fa-copy px-2 cursor-pointer" title="Copy implant link to clipboard"></i><i onclick="shell.openExternal('${implantLink}')" class="fa-solid px-2 fa-arrow-up-right-from-square cursor-pointer" title="Open implant in browser"></i><i onclick="ipcRenderer.invoke('deleteImplantById', '${implantId}')" class="px-2 fa-solid fa-trash-can cursor-pointer" title="Delete implant"></i></td></td>
            </tr>`
            document.getElementById("implants-table-body").innerHTML += tableRow
        }) 
    })

    ipcRenderer.on("refreshImplants", () => {
        ipcRenderer.invoke("getAllImplants")
    });

    ipcRenderer.on("refreshHosts", () => {
        ipcRenderer.invoke("getAllHosts")
    });

    ipcRenderer.invoke("getAllFindings")
    ipcRenderer.on("findings", (event, findings) => {
        // Clear current findings from DOM
        document.getElementById("findings-table-body").innerHTML = "";
        findings.forEach(finding => {
            const timestamp = new Date(finding.timestamp).toLocaleString()
            const findingId = xssSanitize(finding._id.toString())
            const findingName = xssSanitize(finding.name)
            const findingValue = xssSanitize(finding.value)
            const findingHostId = xssSanitize(finding.hostId)
            const findingAuthor = xssSanitize(finding.createdBy)
            const tableRow = `<tr>
                <td class="border px-4 py-2 truncate">${timestamp}</td>
                <td class="border px-4 py-2 truncate">${findingName}</td>
                <td class="border px-4 py-2 truncate">${findingValue}</td>
                <td class="border px-4 py-2 truncate">${findingAuthor}</td>
                <td class="border px-4 py-2 truncate">${findingHostId}</td>
                <td class="border px-4 py-2 truncate"><i onclick="navigator.clipboard.writeText('${findingValue}')" class="fa-solid fa-copy px-2 cursor-pointer" title="Copy finding value to clipboard"></i><i onclick="ipcRenderer.invoke('deleteFindingById', '${findingId}')" class="px-2 fa-solid fa-trash-can cursor-pointer" title="Delete finding"></i></td></td>
            </tr>`
            document.getElementById("findings-table-body").innerHTML += tableRow
        }) 
    })

    ipcRenderer.on("refreshFindings", () => {
        ipcRenderer.invoke("getAllFindings")
    });

    ipcRenderer.invoke("getAllPayloads")
    ipcRenderer.on("payloads", (event, payloads) => {
        // Clear current payloads from DOM
        document.getElementById("payloads-table-body").innerHTML = "";
        document.getElementById("payload-editor-list").innerHTML = "";
        payloads.forEach(payload => {
            const payloadId = xssSanitize(payload._id.toString())
            const payloadName = xssSanitize(payload.name)
            const payloadDescription = xssSanitize(payload.description)
            const payloadCompatibility = xssSanitize(payload.compatibility)
            const payloadType = xssSanitize(payload.type)
            const payloadAuthor = xssSanitize(payload.author)
            const payloadRisk = payload.risk
            let payloadNotes = ""
            if(payload.notes !== undefined && payload.notes !== null && payload.notes !== "") {
                payloadNotes = xssSanitize(payload.notes)
            }
            const tableRow = `<tr class="hover:bg-slate-100 cursor-pointer" draggable="true" ondragend="dragEnd()" ondragstart="drag(event)">
                <td class="border px-4 py-2 truncate">${payloadName}</td>
                <td class="border px-4 py-2 truncate text-left max-w-lg" title="${payloadDescription}">${payloadDescription}</td>
                <td class="border px-4 py-2 truncate">${payloadCompatibility}</td>
                <td class="border px-4 py-2 truncate">${payloadType}</td>
                <td class="border px-4 py-2 truncate">${payloadAuthor}</td> 
                <td class="border px-4 py-2 truncate">${payloadRisk}</td>
                <td class="border px-4 py-2 truncate text-left max-w-lg" title="${payloadNotes}">${payloadNotes}</td>
                <td class="border px-4 py-2 truncate"><i onclick="navigator.clipboard.writeText('${payloadName}')" class="fa-solid fa-copy px-2" title="Copy payload name to clipboard"></i><i onclick="document.getElementById('payloadEditorModal').classList.remove('hidden'); loadPayloadEditor(${JSON.stringify(payload).split('"').join("&quot;")})" class="fa-solid fa-pencil px-2" title="Edit payload"></i><i onclick="deletePayload('${xssSanitize(payload._id.toString())}')" class="px-2 fa-solid fa-trash-can" title="Delete payload"></i></td>
            </tr>`

            document.getElementById("payloads-table-body").innerHTML += tableRow
            document.getElementById("payload-editor-list").innerHTML += `<li class="cursor-pointer hover:text-rose-500" onclick="loadPayloadEditor(${JSON.stringify(payload).split('"').join("&quot;")})">${payloadName}</li>`
        })
    })

    ipcRenderer.invoke("getAllHosts")
    ipcRenderer.on("hosts", (event, hosts) => {
        // Clear current hosts from DOM
        document.getElementById("hosts-table-body").innerHTML = "";
        hosts.forEach(host => {
            const hostId = xssSanitize(host._id.toString())
            const hostExternalIP = xssSanitize(host.externalIP)
            const parsedUserAgent = parseUserAgent(host.userAgent)
            const hostBrowser = xssSanitize(parsedUserAgent.browser)
            const hostOS = xssSanitize(parsedUserAgent.os)
            const hostCurrentTab = xssSanitize(host.currentTab)
            const offlineAfter = host.offlineAfter
            const markedAsOffline = host.markedAsOffline
            const diff = Math.round(Math.abs(new Date() - new Date(host.lastCheckIn)) / 1000)
            const hostLastSeen = diff < 60 ? `${diff} seconds ago` : `${Math.round(diff / 60)} minutes ago`
            const tableRow = `<tr class="hover:bg-slate-100 cursor-pointer" draggable="true" ondragend="dragEnd()" ondragstart="drag(event)">
                <td class="border px-4 py-2 truncate">${hostId}</td>
                ${diff < offlineAfter && !markedAsOffline ? '<td class="border px-4 py-2 truncate"><a class="h-5 w-5 bg-green-200 text-green-800 rounded-md px-4">Online</a></td>' : '<td class="border px-4 py-2 truncate"><a class="h-5 w-5 bg-red-200 text-red-800 rounded-md px-4">Offline</a></td>'}
                <td class="border px-4 py-2 truncate">${hostExternalIP}</td>
                <td class="border px-4 py-2 truncate">${hostOS}</td>
                <td class="border px-4 py-2 truncate">${hostBrowser}</td>
                <td class="border px-4 py-2 truncate">${hostCurrentTab}</td>
                <td class="border px-4 py-2 truncate">${hostLastSeen}</td>
                <td class="border px-4 py-2 truncate"><i onclick="navigator.clipboard.writeText('${hostId}')" class="fa-solid fa-copy px-2" title="Copy host ID to clipboard"></i><i onclick="markHostAsOffline('${hostId}')" class="px-2 fa-solid fa-skull-crossbones" title="Mark as offline"></i><i class="px-2 fa-solid fa-trash-can" title="Delete host"></i></td>     
            </tr>`
            document.getElementById("hosts-table-body").innerHTML += tableRow
        })
    })

    function markHostAsOffline(hostId) {
        ipcRenderer.invoke("markHostAsOffline", hostId)
    }

    let commandInput = document.getElementById("command");
    let commandOutput = document.getElementById("commandOutput");
    let commandContainer = document.getElementById("commandContainer");
    commandInput.focus(); // Focus input onload

    commandInput.addEventListener("keydown", function(event) {
        if (event.key === "Enter" && commandInput.value !== "") {
            commandHistoryIndex = 0;
            if (commandInput.value === "clear") {
                commandOutput.innerHTML = ""
                ipcRenderer.invoke("processCommand", commandInput.value)
                commandInput.value = ""
            } else {
                commandOutput.innerHTML += `<p class="text-rose-400 font-semibold whitespace-nowrap inline-block pr-2.5">${xssSanitize(globalUsername)}@wagyu #</p><pre class="inline-block font-mono ">${xssSanitize(commandInput.value)}</pre>`;
                ipcRenderer.invoke("processCommand", commandInput.value)
                .then(result => {  
                    commandHistory = result.history
                    const type = result.type
                    let output = result.message
                    output = xssSanitize(output)

                    if (type === "error") {
                        commandOutput.innerHTML += `<pre class="text-red-600 font-mono">${output}</pre>`;
                    } else if (type === "success") {
                        commandOutput.innerHTML += `<pre class="text-green-500 font-mono">${output}</pre>`;
                    }else {
                        commandOutput.innerHTML += `<pre class="font-mono">${output}</pre>`;
                    }

                    commandContainer.scrollTop = commandContainer.scrollHeight;
                    commandInput.value = "";
                });
            }
        } else if(event.key === "ArrowUp") {
            if (commandHistoryIndex < commandHistory.length) {
                commandHistoryIndex++;
                commandInput.value = commandHistory[commandHistory.length - commandHistoryIndex];
                setTimeout(function(){ commandInput.selectionStart = commandInput.selectionEnd = 10000; }, 5);
            }
        } else if(event.key === "ArrowDown") {
            if (commandHistoryIndex > 0) {
                commandHistoryIndex--;
                if (commandHistoryIndex === 0) {
                    commandInput.value = "";
                } else {
                    commandInput.value = commandHistory[commandHistory.length - commandHistoryIndex];
                    commandInput.selectionStart = commandInput.selectionEnd = commandInput.value.length;
                }
            }
        } else {
            commandHistoryIndex = 0;
        }
    });

    // Drag and drop

    function allowDrop(event) {
        event.preventDefault();

    }

    function dragEnd(){
        document.getElementById("dragDropOverlay").classList.add("hidden");
    }

    function drag(event) {
        const host = event.target.cells[0].innerText
        document.getElementById("dragDropOverlay").classList.remove("hidden");
        event.dataTransfer.setData("host", host);
    }

    function drop(event) {
        event.stopPropagation();
        event.preventDefault();
        const data = event.dataTransfer.getData("host");
        document.getElementById("command").value += data + " ";
    }

</script>
<style>
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    *:focus {
        outline: none;
    }

    *::-webkit-scrollbar {
        width: 15px;
    }

    *::-webkit-scrollbar-corner {
        background: rgba(0,0,0,0);
    }

    *::-webkit-scrollbar-track {
        background-color: rgba(0,0,0,0);
    }

    #eventLog::-webkit-scrollbar-thumb {
        background-color: rgb(135, 156, 173);
        border-radius: 10px;
        border: 4px solid rgba(0,0,0,0);
        background-clip: content-box;
        min-width: 32px;
        min-height: 32px;
    }

    #commandContainer::-webkit-scrollbar-thumb {
        background-color: rgb(201, 216, 221);
        border-radius: 10px;
        border: 4px solid rgba(0,0,0,0);
        background-clip: content-box;
        min-width: 32px;
        min-height: 32px;
    }

    #tables::-webkit-scrollbar-thumb {
        background-color: rgb(241, 241, 241);
        border-radius: 10px;
        border: 4px solid rgba(0,0,0,0);
        background-clip: content-box;
        min-width: 32px;
        min-height: 32px;
    }
    
</style>
</body>
</html>